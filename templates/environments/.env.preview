# ==============================================
# PREVIEW ENVIRONMENT
# ==============================================
# Temporary preview deployment for PRs/branches
# Ephemeral environment for testing changes

# ==============================================
# üåç ENVIRONMENT
# ==============================================
NODE_ENV=preview
APP_ENV=preview
DEBUG=true
LOG_LEVEL=info

# ==============================================
# üåê APPLICATION URLS
# ==============================================
# Dynamic URLs based on PR/branch
APP_NAME=My App Preview ${BRANCH_NAME}
APP_URL=https://preview-${PR_NUMBER}.myapp.com
API_BASE_URL=https://preview-${PR_NUMBER}-api.myapp.com/api
FRONTEND_URL=https://preview-${PR_NUMBER}.myapp.com
BACKEND_URL=https://preview-${PR_NUMBER}-api.myapp.com

# Ports
PORT=3000
FRONTEND_PORT=3000

# ==============================================
# üóÑÔ∏è DATABASE CONFIGURATION
# ==============================================
# PostgreSQL (Preview Database - Isolated per PR)
DB_HOST=preview-db.myapp.com
DB_PORT=5432
DB_NAME=myapp_preview_${PR_NUMBER}
DB_USER=preview_user
DB_PASSWORD=${PREVIEW_DB_PASSWORD}
DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=require

# MongoDB (Preview Database)
MONGODB_URI=${PREVIEW_MONGODB_URI}
MONGODB_DATABASE=myapp_preview_${PR_NUMBER}
MONGODB_USERNAME=${PREVIEW_MONGODB_USER}
MONGODB_PASSWORD=${PREVIEW_MONGODB_PASSWORD}

# Redis Cache (Shared Preview Redis with namespace)
REDIS_HOST=preview-redis.myapp.com
REDIS_PORT=6379
REDIS_URL=rediss://${REDIS_HOST}:${REDIS_PORT}
REDIS_PASSWORD=${PREVIEW_REDIS_PASSWORD}
REDIS_KEY_PREFIX=preview:${PR_NUMBER}:

# ==============================================
# üîê AUTHENTICATION & SECURITY
# ==============================================
# JWT Configuration (Preview Secrets)
JWT_SECRET=${PREVIEW_JWT_SECRET}
JWT_ACCESS_SECRET=${PREVIEW_JWT_ACCESS_SECRET}
JWT_REFRESH_SECRET=${PREVIEW_JWT_REFRESH_SECRET}
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=24h

# Session
SESSION_SECRET=${PREVIEW_SESSION_SECRET}
SESSION_MAX_AGE=86400000

# Encryption
ENCRYPTION_KEY=${PREVIEW_ENCRYPTION_KEY}

# ==============================================
# üåê CORS & SECURITY
# ==============================================
CORS_ORIGIN=https://preview-${PR_NUMBER}.myapp.com
ALLOWED_ORIGINS=https://preview-${PR_NUMBER}.myapp.com,https://preview-${PR_NUMBER}-api.myapp.com

# Rate Limiting (Lenient for testing)
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=500

# Security Headers
HELMET_ENABLED=true
HSTS_MAX_AGE=0

# ==============================================
# ü§ñ AI SERVICES (Preview/Dev Keys)
# ==============================================
# OpenAI (Shared dev keys with lower limits)
OPENAI_API_KEY=${PREVIEW_OPENAI_API_KEY}
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=1000

# Anthropic Claude
ANTHROPIC_API_KEY=${PREVIEW_ANTHROPIC_API_KEY}

# Google AI
GOOGLE_AI_API_KEY=${PREVIEW_GOOGLE_AI_API_KEY}

# ==============================================
# üîß EXTERNAL SERVICES (Preview Keys)
# ==============================================
# GitHub Integration
GITHUB_TOKEN=${PREVIEW_GITHUB_TOKEN}
GITHUB_USERNAME=myapp-preview
GITHUB_REPO_DEFAULT=myapp-preview-${PR_NUMBER}

# OAuth Providers (Preview/Test)
GOOGLE_CLIENT_ID=${PREVIEW_GOOGLE_CLIENT_ID}
GOOGLE_CLIENT_SECRET=${PREVIEW_GOOGLE_CLIENT_SECRET}
GOOGLE_CALLBACK_URL=https://preview-${PR_NUMBER}-api.myapp.com/auth/google/callback

GITHUB_CLIENT_ID=${PREVIEW_GITHUB_CLIENT_ID}
GITHUB_CLIENT_SECRET=${PREVIEW_GITHUB_CLIENT_SECRET}
GITHUB_CALLBACK_URL=https://preview-${PR_NUMBER}-api.myapp.com/auth/github/callback

# ==============================================
# üìß EMAIL CONFIGURATION (Preview/Mock)
# ==============================================
SMTP_HOST=${PREVIEW_SMTP_HOST}
SMTP_PORT=587
SMTP_USER=${PREVIEW_SMTP_USER}
SMTP_PASSWORD=${PREVIEW_SMTP_PASSWORD}
SMTP_FROM=preview-${PR_NUMBER}@myapp.com
EMAIL_ENABLED=true

# ==============================================
# ‚òÅÔ∏è CLOUD STORAGE (Preview)
# ==============================================
# AWS S3 (Preview Bucket with PR namespace)
AWS_ACCESS_KEY_ID=${PREVIEW_AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY=${PREVIEW_AWS_SECRET_ACCESS_KEY}
AWS_REGION=us-east-1
AWS_S3_BUCKET=myapp-preview-assets
AWS_S3_PREFIX=pr-${PR_NUMBER}/

# Supabase (Preview Project)
SUPABASE_URL=${PREVIEW_SUPABASE_URL}
SUPABASE_ANON_KEY=${PREVIEW_SUPABASE_ANON_KEY}
SUPABASE_SERVICE_ROLE_KEY=${PREVIEW_SUPABASE_SERVICE_KEY}

# ==============================================
# üí≥ PAYMENT PROVIDERS (Test Mode)
# ==============================================
# Stripe (Test Keys)
STRIPE_PUBLIC_KEY=${PREVIEW_STRIPE_PUBLIC_KEY}
STRIPE_SECRET_KEY=${PREVIEW_STRIPE_SECRET_KEY}
STRIPE_WEBHOOK_SECRET=${PREVIEW_STRIPE_WEBHOOK_SECRET}

# ==============================================
# üìä MONITORING & ANALYTICS (Preview)
# ==============================================
# Sentry (Preview Environment)
SENTRY_DSN=${PREVIEW_SENTRY_DSN}
SENTRY_ENVIRONMENT=preview-${PR_NUMBER}
SENTRY_ENABLED=true

# Analytics (Disabled or separate preview tracking)
ANALYTICS_ID=
ANALYTICS_ENABLED=false

# Application Performance Monitoring
APM_ENABLED=false
NEW_RELIC_LICENSE_KEY=

# ==============================================
# üé≠ FEATURE FLAGS
# ==============================================
# Enable all features for testing in preview
FEATURE_NEW_UI=true
FEATURE_BETA_FEATURES=true
FEATURE_EXPERIMENTAL=true
FEATURE_ANALYTICS=false
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_WEBSOCKETS=true
FEATURE_PAYMENT_PROCESSING=true

# ==============================================
# üß™ TESTING & DEBUGGING
# ==============================================
# Testing (Enabled in preview)
TEST_TIMEOUT=10000
TEST_DATABASE_URL=${DATABASE_URL}

# Browser Testing
PLAYWRIGHT_HEADLESS=true
PLAYWRIGHT_BROWSER=chromium
PLAYWRIGHT_TIMEOUT=30000

# Debugging (Enabled for preview)
DEBUG_SQL=true
DEBUG_API=true
VERBOSE_LOGGING=true

# ==============================================
# üîÑ CACHE CONFIGURATION
# ==============================================
CACHE_ENABLED=true
CACHE_TTL=1800
CACHE_PREFIX=preview:${PR_NUMBER}:

# ==============================================
# üìù LOGGING
# ==============================================
LOG_FILE=/var/log/myapp/preview-${PR_NUMBER}.log
LOG_FORMAT=json
LOG_SQL_QUERIES=true
LOG_HTTP_REQUESTS=true

# ==============================================
# üöÄ BUILD & DEPLOYMENT
# ==============================================
BUILD_PATH=dist
SOURCE_MAP=true
MINIFY=true

# Preview Metadata
BRANCH_NAME=${BRANCH_NAME}
PR_NUMBER=${PR_NUMBER}
COMMIT_SHA=${COMMIT_SHA}
DEPLOYED_AT=${DEPLOYED_AT}
DEPLOYED_BY=${DEPLOYED_BY}

# ==============================================
# üåç LOCALIZATION
# ==============================================
DEFAULT_LANGUAGE=en
SUPPORTED_LANGUAGES=en,es,pt
TIMEZONE=UTC

# ==============================================
# üìä PERFORMANCE
# ==============================================
MAX_REQUEST_SIZE=10mb
REQUEST_TIMEOUT=30000
CONNECTION_POOL_SIZE=10

# ==============================================
# üîß DEPLOYMENT CONFIGURATION
# ==============================================
# Container/Orchestration
CONTAINER_REGISTRY=${PREVIEW_CONTAINER_REGISTRY}
IMAGE_TAG=preview-${PR_NUMBER}-${COMMIT_SHA}

# Health Checks
HEALTH_CHECK_INTERVAL=30000
READINESS_PROBE_PATH=/api/health
LIVENESS_PROBE_PATH=/api/health/live

# Auto-scaling (Limited for preview)
MIN_REPLICAS=1
MAX_REPLICAS=2
TARGET_CPU_UTILIZATION=80

# ==============================================
# üåê CDN & ASSETS
# ==============================================
CDN_URL=https://cdn-preview.myapp.com
ASSETS_URL=https://assets-preview.myapp.com/pr-${PR_NUMBER}
PUBLIC_URL=https://preview-${PR_NUMBER}.myapp.com

# ==============================================
# üîí SSL/TLS
# ==============================================
SSL_ENABLED=true
FORCE_HTTPS=true

# ==============================================
# üìä LIFECYCLE & CLEANUP
# ==============================================
# Preview environments auto-cleanup
PREVIEW_LIFETIME_HOURS=72
PREVIEW_IDLE_TIMEOUT_HOURS=24
PREVIEW_AUTO_CLEANUP=true

# Cleanup on PR close
CLEANUP_ON_PR_CLOSE=true
CLEANUP_DATABASE=true
CLEANUP_S3_FILES=true
CLEANUP_LOGS=true

# ==============================================
# üîó RELATED RESOURCES
# ==============================================
# Links for easy access
PR_URL=https://github.com/${GITHUB_REPO}/pull/${PR_NUMBER}
DEPLOYMENT_DASHBOARD=https://dashboard.myapp.com/preview/${PR_NUMBER}

# ==============================================
# üö® NOTIFICATIONS
# ==============================================
# Notify on deployment
SLACK_WEBHOOK_URL=${PREVIEW_SLACK_WEBHOOK_URL}
SLACK_CHANNEL=#preview-deployments
NOTIFY_ON_DEPLOY=true
NOTIFY_ON_ERROR=true

# ==============================================
# üîç PREVIEW-SPECIFIC FEATURES
# ==============================================
# Show debug info in preview
SHOW_DEBUG_INFO=true
SHOW_BUILD_INFO=true
SHOW_FEATURE_FLAGS=true

# Allow password-less access for team (via magic link)
ALLOW_MAGIC_LINK_ACCESS=true
MAGIC_LINK_SECRET=${PREVIEW_MAGIC_LINK_SECRET}

# Preview banner
SHOW_PREVIEW_BANNER=true
PREVIEW_BANNER_TEXT=Preview Environment - PR #${PR_NUMBER}
