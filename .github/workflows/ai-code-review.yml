name: AI-Assisted Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths:
      - '**/*.js'
      - '**/*.ts'
      - '**/*.jsx'
      - '**/*.tsx'
      - '**/*.py'
      - '**/*.go'
      - '**/*.java'
      - '**/*.md'

permissions:
  contents: read
  pull-requests: write
  security-events: write

jobs:
  code-quality-check:
    name: Code Quality Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v40
        with:
          files: |
            **/*.js
            **/*.ts
            **/*.jsx
            **/*.tsx
            **/*.py
            **/*.go
            **/*.java
      
      - name: List changed files
        if: steps.changed-files.outputs.any_changed == 'true'
        run: |
          echo "Changed files:"
          echo "${{ steps.changed-files.outputs.all_changed_files }}"
      
      - name: Setup Node.js
        if: steps.changed-files.outputs.any_changed == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Check code complexity
        if: steps.changed-files.outputs.any_changed == 'true'
        run: |
          echo "‚úÖ Code quality check completed"
          echo "This workflow demonstrates AI-assisted code review setup."
          echo "Add your preferred AI code review tools here."
      
      - name: Comment PR
        if: steps.changed-files.outputs.any_changed == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const changedFiles = '${{ steps.changed-files.outputs.all_changed_files }}'.split(' ');
            const fileCount = changedFiles.length;
            
            const comment = `## ü§ñ AI Code Review Assistant
            
            **Files Changed:** ${fileCount}
            
            ### ‚úÖ Automated Checks Completed
            - Code quality analysis passed
            - File structure validated
            
            ### üìã Review Checklist
            Please ensure you've reviewed:
            - [ ] Code follows project style guide
            - [ ] Tests are included for new functionality
            - [ ] No security vulnerabilities introduced
            - [ ] Performance implications considered
            - [ ] Documentation updated if needed
            
            ### üí° Recommendations
            - Use the [AI Code Review Prompts](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/prompts/code-review/ai-code-review-prompts.md) for detailed review
            - Check the [AI Code Review Guidelines](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/ai-collaboration/ai-code-review-guidelines.md)
            
            *This is an automated comment. Configure AI tools in the workflow for detailed analysis.*`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

  security-scan:
    name: Security Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: javascript, python
          queries: security-and-quality
      
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3
      
      - name: Security check summary
        run: |
          echo "‚úÖ Security scan completed"
          echo "Check the Security tab for detailed results"

  dependency-review:
    name: Dependency Review
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Dependency Review
        uses: actions/dependency-review-action@v3
        with:
          fail-on-severity: moderate
          comment-summary-in-pr: true

  documentation-check:
    name: Documentation Review
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Check for README updates
        id: readme-check
        uses: tj-actions/changed-files@v40
        with:
          files: |
            **/*.md
      
      - name: Documentation summary
        if: steps.readme-check.outputs.any_changed == 'true'
        run: |
          echo "‚úÖ Documentation files were modified"
          echo "Modified files:"
          echo "${{ steps.readme-check.outputs.all_changed_files }}"
      
      - name: Comment on documentation changes
        if: steps.readme-check.outputs.any_changed == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const comment = `## üìö Documentation Updated
            
            Documentation files have been modified in this PR.
            
            ### üìù Review Checklist
            - [ ] Documentation is clear and accurate
            - [ ] Examples are working and helpful
            - [ ] Links are not broken
            - [ ] Formatting is correct
            - [ ] Spelling and grammar checked
            
            Refer to [Documentation Standards](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/documentation-standards.md) for guidelines.`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

  review-summary:
    name: Review Summary
    runs-on: ubuntu-latest
    needs: [code-quality-check, security-scan, dependency-review, documentation-check]
    if: always()
    
    steps:
      - name: Generate review summary
        uses: actions/github-script@v7
        with:
          script: |
            const summary = `## üìä AI Code Review Summary
            
            All automated checks have completed. Review the results above.
            
            ### Next Steps
            1. Review automated findings
            2. Address any security or quality issues
            3. Use AI prompts for detailed code review
            4. Request human review when ready
            
            **Resources:**
            - [AI Code Review Guidelines](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/ai-collaboration/ai-code-review-guidelines.md)
            - [Code Review Prompts](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/prompts/code-review/ai-code-review-prompts.md)
            - [Code Review Checklist](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/coding-guidelines/code-review-checklist.md)`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: summary
            });
